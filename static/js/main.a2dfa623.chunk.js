(this["webpackJsonpwoven-images"]=this["webpackJsonpwoven-images"]||[]).push([[0],{100:function(e,t,n){},173:function(e,t,n){},174:function(e,t,n){},175:function(e,t,n){},178:function(e,t,n){},179:function(e,t,n){},180:function(e,t,n){},181:function(e,t,n){},182:function(e,t,n){},184:function(e,t,n){},185:function(e,t,n){},186:function(e,t,n){},187:function(e,t,n){},188:function(e,t,n){"use strict";n.r(t);var a,r,s,i,c,o=n(12),l=n.n(o),d=n(84),u=n.n(d),h=(n(98),n(18)),x=n(14),T=n(15),f=(n(99),n(100),n(8)),j=function(e){var t={gridRow:e.row+1,gridColumn:e.col+1};return e.thread&&(t.backgroundColor=e.palette.threadPalette[e.thread.threadPaletteIndex].color),Object(f.jsx)("div",{className:"button "+(e.value?"isActive":""),style:t,onClick:e.onClickHandler})},p=(n(67),function(e){var t=function(t){e.onClickHandler(t,e.subGridType)},n=e.gridValues.map((function(n,a){return n.map((function(n,r){return Object(f.jsx)(j,{value:n,row:a,col:r,cellSize:e.cellSize,onClickHandler:t,palette:e.palette})}))}));return Object(f.jsx)("div",{className:"ButtonGrid "+(e.className?e.className:""),style:{gridTemplateRows:"repeat(1fr, ".concat(e.gridValues.length,")"),gridTemplateColumns:"repeat(1fr, ".concat(e.gridValues[0].length,")"),width:"".concat(e.gridValues[0].length*e.cellSize,"px"),height:"".concat(e.gridValues.length*e.cellSize,"px")},children:n})});!function(e){e[e.WARPTHREADTABLE=0]="WARPTHREADTABLE",e[e.WEFTTHREADTABLE=1]="WEFTTHREADTABLE",e[e.TIEUPTABLE=2]="TIEUPTABLE",e[e.HARNESSTOTHREADTABLE=3]="HARNESSTOTHREADTABLE",e[e.TREADLINGTABLE=4]="TREADLINGTABLE"}(a||(a={})),function(e){e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL"}(r||(r={})),function(e){e[e.SET_WARPCOUNT=0]="SET_WARPCOUNT",e[e.SET_WEFTCOUNT=1]="SET_WEFTCOUNT",e[e.SET_TREADLECOUNT=2]="SET_TREADLECOUNT",e[e.SET_HARNESSCOUNT=3]="SET_HARNESSCOUNT"}(s||(s={})),function(e){e[e.SET_HARNESSTOTHREADATTACHMENTS=0]="SET_HARNESSTOTHREADATTACHMENTS",e[e.SET_TREADLETOHARNESSATTACHMENTS=1]="SET_TREADLETOHARNESSATTACHMENTS",e[e.SET_TREADLINGINSTRUCTION=2]="SET_TREADLINGINSTRUCTION",e[e.SET_HARNESSCOUNT=3]="SET_HARNESSCOUNT",e[e.SET_TREADLECOUNT=4]="SET_TREADLECOUNT",e[e.SET_WEFTCOUNT=5]="SET_WEFTCOUNT",e[e.SET_WARPCOUNT=6]="SET_WARPCOUNT",e[e.SET_STATE=7]="SET_STATE",e[e.SET_WARPTHREADTHREADPALETTEINDEX=8]="SET_WARPTHREADTHREADPALETTEINDEX",e[e.SET_WEFTTHREADTHREADPALETTEINDEX=9]="SET_WEFTTHREADTHREADPALETTEINDEX",e[e.SET_SELECTEDTHREADDATASOURCEINDEX=10]="SET_SELECTEDTHREADDATASOURCEINDEX",e[e.SET_SELECTEDTHREADDATASOURCE=11]="SET_SELECTEDTHREADDATASOURCE",e[e.ADD_THREADDATASOURCE=12]="ADD_THREADDATASOURCE"}(i||(i={})),function(e){e[e.Orthographic=0]="Orthographic",e[e.Perspective=1]="Perspective"}(c||(c={}));var m=n(189).v4,E=n(40),b={harnessCount:4,treadleCount:4,warpCount:16,weftCount:16},O={threadPalette:[D("#FFFFFF"),D("#000000")],selectedIndex:0},g=function(e){return parseInt(e.substring(3,5),16)},v=function(e){return parseInt(e.substring(5,7),16)};var S=function(){return{threads:new Set}},A=function(){return{harnesses:new Set}},C=function(e,t){return{id:e,threadPaletteIndex:t}};function N(e){var t=e.data,n=t.threading,a=t.tieup,r=t.treadling,s=function(e){var t=/(\d+)/g,n=e.match(t);return n?n.map((function(e){return parseInt(e)})):[]}(a);return{warpCount:n.split(",").length,weftCount:w(r).split(",").length,treadleCount:a.split(",").length,harnessCount:Math.max.apply(Math,s)}}function w(e){var t=e.replaceAll(/(\d+)x(\d+)/g,(function(e,t,n){return(t+",").repeat(n)}));return(t=t.replaceAll(/,,/g,",")).endsWith(",")&&(t=t.substring(0,t.length-1)),t}function D(e){return{color:e}}function R(){return m()}function y(e,t){return new Array(e).fill(null).map((function(e){return t()}))}function I(e){var t,n,a,r;return{id:R(),dimensions:e,harnesses:(r=e.harnessCount,y(r,S)),warpThreads:(a=e.warpCount,new Array(a).fill(null).map((function(e,t){return C(t,1)}))),weftThreads:function(e){return new Array(e).fill(null).map((function(e,t){return C(t,0)}))}(e.weftCount),treadles:(n=e.treadleCount,y(n,A)),treadlingInstructions:(t=e.weftCount,y(t,(function(){return null}))),threadDataSource:{color:"#FFFFFF"},name:"untitled",indexedThreadPalette:E(O)}}var P=function(e){return JSON.stringify({id:e.id,dimensions:e.dimensions,treadles:L(e.treadles,e.harnesses),harnesses:L(e.harnesses,e.warpThreads),treadlingInstructions:e.treadlingInstructions.map((function(t){return t?e.treadles.indexOf(t):-1})),warpThreads:e.warpThreads,weftThreads:e.weftThreads,threadDataSource:e.threadDataSource,name:e.name,indexedThreadPalette:e.indexedThreadPalette})};function L(e,t){var n=[];return e.forEach((function(e,a){n.push([]),"harnesses"in e?e.harnesses.forEach((function(e){n[a].push(t.indexOf(e))})):"threads"in e&&e.threads.forEach((function(e){n[a].push(t.indexOf(e))}))})),n}function H(e){var t=I(N(e)),n=e.data,a=n.threading,r=n.tieup,s=n.treadling;return a.split(",").reverse().map((function(e){return parseInt(e)})).forEach((function(e,n){var a=t.harnesses.length-e;t.harnesses[a].threads.add(t.warpThreads[n])})),r.split(",").map((function(e){return e.split("+").map((function(e){return parseInt(e)}))})).forEach((function(e,n){e.forEach((function(e){var a=t.harnesses.length-1-(e-1);t.treadles[n].harnesses.add(t.harnesses[a])}))})),w(s).split(",").map((function(e){return parseInt(e)})).forEach((function(e,n){t.treadlingInstructions[n]=t.treadles[e-1]})),t.name=e.name,t}n(173),n(174);var k,_=function(e){var t=Object(o.useState)(e.dimensions),n=Object(T.a)(t,2),a=n[0],r=n[1];Object(o.useEffect)((function(){r(e.dimensions)}),[e.dimensions]);var s=function(e){e.preventDefault(),r(Object(x.a)(Object(x.a)({},a),{},Object(h.a)({},e.target.name,parseInt(e.target.value))))},i=Object(o.useMemo)((function(){return Object.keys(a).every((function(t){return a[t]===e.dimensions[t]}))}),[e.dimensions,a]),c=Object.keys(e.dimensions).map((function(t){return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("label",{className:"InputLabel",htmlFor:t,children:(n=t,r=" ",r="undefined"===typeof r?"_":r,n.replace(/([a-z\d])([A-Z])/g,"$1"+r+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+r+"$2").toLowerCase()+" ")}),Object(f.jsx)("input",{className:"InputField input-dimension",style:{display:"inline"},type:"textfield",name:t,onChange:s,value:a[t]}),Object(f.jsx)("span",{children:"\u2192"}),Object(f.jsx)("p",{className:"CurrentDimension",style:{display:"inline"},children:e.dimensions[t]})]});var n,r}));return Object(f.jsxs)("div",{className:"Panel",children:[Object(f.jsx)("h1",{className:"FormHeader",children:"Dimensions Editor"}),Object(f.jsx)("div",{className:"PanelContent",children:Object(f.jsxs)("form",{className:"DimensionsForm input-grid input-grid-4",onSubmit:function(t){t.preventDefault(),e.onDimensionsChange(a)},children:[c,Object(f.jsx)("button",{className:"ApplyBtn",type:"submit",disabled:i,children:"Apply"})]})})]})},F=(n(175),n(40),function(e){var t=Object(o.useState)(D("000000")),n=Object(T.a)(t,2),a=n[0],r=n[1],s=Object(o.useState)(!1),i=Object(T.a)(s,2),c=i[0],l=i[1],d=e.indexedThreadPalette.threadPalette.map((function(t,n){var a="Thread"+(n==e.indexedThreadPalette.selectedIndex?" selected":"");return Object(f.jsx)("div",{className:a,id:"thread-"+n.toString(),style:{backgroundColor:t.color},onClick:function(t){e.onSelectThreadDataSource(t.target.id.split("-")[1])}})}));return Object(f.jsxs)("div",{className:"ThreadEditorContainer Panel",children:[Object(f.jsx)("h1",{children:"Thread Palette"}),Object(f.jsxs)("div",{className:"PanelContent",children:[Object(f.jsxs)("div",{className:"ThreadContainer",children:[d,Object(f.jsx)("button",{className:"AddThreadButton",onClick:function(t){e.onAddThreadDataSource(a)},children:"+"})]}),Object(f.jsx)("div",{className:"ThreadAttributeDesigner",children:Object(f.jsx)("input",{className:"ColorPicker",type:"color",id:"ColorPicker",onChange:function(t){if(!c){var n=Object(x.a)(Object(x.a)({},e.indexedThreadPalette.threadPalette[e.indexedThreadPalette.selectedIndex]),{},{color:t.target.value});e.onSetThreadDataSource(n)}r(Object(x.a)(Object(x.a)({},a),{},{color:t.target.value}))}})}),Object(f.jsx)("button",{className:"LockBtn",onClick:function(){l(!c)},children:c?"Unlock Palette":"Lock Palette"})]})]})}),U=function(e){var t=function(t){e.onClickHandler(t,e.subGridType)},n=e.gridValues.map((function(n,a){return Object(f.jsx)(j,{styleDataSource:e.palette.threadPalette[n.threadPaletteIndex],col:e.orientation===r.HORIZONTAL?a:0,row:e.orientation===r.VERTICAL?a:0,cellSize:{width:e.cellSize.width,height:e.cellSize.height},onClickHandler:t,thread:e.gridValues[a],palette:e.palette})}));return Object(f.jsx)("div",{className:"ButtonGrid "+(e.className?e.className:""),style:{gridTemplateColumns:"repeat(1fr, ".concat(e.orientation===r.VERTICAL?e.gridValues.length:1,")"),gridTemplateRows:"repeat(1fr, ".concat(e.orientation===r.HORIZONTAL?e.gridValues.length:1,")"),width:"".concat((e.orientation===r.HORIZONTAL?e.gridValues.length:1)*e.cellSize.width,"px"),height:"".concat((e.orientation===r.VERTICAL?e.gridValues.length:1)*e.cellSize.height,"px")},children:n})},B=function(e){return Object(f.jsxs)("div",{className:"Panel",children:[Object(f.jsx)("h1",{className:"FormHeader",children:"Image Editor"}),Object(f.jsx)("div",{className:"PanelContent input-grid",children:e.children})]})},W=n(193),M=n(194),V=n(195),z=n(0),G=n(1),X=n(2),Z=n(5),J=n(6),$=n(92),q="varying vec2 vUv;\nvoid main() {\n    gl_FragColor.rgba = vec4(1.,1.,1.,1.);\n}",K=($.a,n(21)),Y=n(192),Q=new Uint8Array(3),ee=Object(Y.a)({patternDataTexture:new z.DataTexture(Q,1,1,z.RGBFormat),repeats:1},"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","varying vec2 vUv;\nuniform float repeats;\nuniform sampler2D patternDataTexture;\nvoid main() {\n    vec2 uv = vUv * repeats;\n    uv = uv - floor(uv);\n    uv.y = 1. - uv.y;\n    gl_FragColor.rgba = texture2D(patternDataTexture, uv);\n    gl_FragColor.a = 1.;\n}\n");Object(K.b)({WeaveDisplayMaterial:ee});var te=function(e,t,n){for(var a,r=e*t,s=new Uint8Array(3*r),i=0;i<r;i++){var c=3*i,o=(a=n[i],parseInt(a.substring(1,3),16)),l=g(n[i]),d=v(n[i]);s[c]=o,s[c+1]=l,s[c+2]=d}return new z.DataTexture(s,e,t,z.RGBFormat)},ne=te(2,2,["#ffffff","#000000","#ffffff","#000000"]);var ae=function(e){var t=Object(o.useRef)(),n=Object(o.useRef)(),a=Object(o.useState)(ne),r=Object(T.a)(a,2),s=r[0],i=r[1],l=Object(K.d)(),d=function(){return Math.max(e.warpThreadCount,e.weftThreadCount)},u=function(){return e.warpThreadCount/d()},h=function(){return e.weftThreadCount/d()},x=function(){return u()/h()},j=function(){return Math.atan(h()/2)*(360/Math.PI)};Object(o.useEffect)((function(){i(te(e.warpThreadCount,e.weftThreadCount,e.colorBuffer)),s.needsUpdate=!0,"fov"in l.camera&&(l.camera.fov=j())}),[e]);var p=e.warpThreadCount*e.unitSize,m=e.weftThreadCount*e.unitSize,E=e.cameraMode===c.Perspective;return Object(f.jsxs)(f.Fragment,{children:[e.cameraMode===c.Orthographic&&Object(f.jsx)(W.a,{makeDefault:!0,args:[p/-2,p/2,m/2,m/-2,0,1e3]}),e.cameraMode===c.Perspective&&Object(f.jsx)(M.a,{makeDefault:!0,position:[0,0,1],args:[j(),x(),.1,2e3],ref:n}),Object(f.jsx)(V.a,{enablePan:E,enableZoom:E,enableRotate:E}),Object(f.jsxs)("mesh",{ref:t,children:[Object(f.jsx)("planeGeometry",{attach:"geometry",args:e.cameraMode===c.Orthographic?[p,m,1,1]:[u(),h(),1,1]}),Object(f.jsx)("weaveDisplayMaterial",{attach:"material",patternDataTexture:s,repeats:e.repeats})]})]})},re=(n(178),function(){return Object(f.jsxs)("div",{className:"Panel InfoPanel",children:[Object(f.jsx)("h1",{children:"Welcome!"}),Object(f.jsxs)("p",{className:"info",children:["The ",Object(f.jsx)("i",{children:"Woven Images"})," editor has several presets for you to get started with. You can load them up via ",Object(f.jsx)("strong",{children:"File > Load Preset."})]}),Object(f.jsxs)("p",{className:"info",children:["Also play around with the ",Object(f.jsx)("i",{children:"pattern scale"})," to see your woven pattern at different scales."]}),Object(f.jsxs)("p",{className:"info",children:["The editor emulates ",Object(f.jsx)("i",{children:"weaving draft"})," notation, where you can enter treadling, tie-up, and threading data and see a live view of the pattern they create."]}),Object(f.jsxs)("p",{className:"info",children:["Lastly, you can also view the pattern in 3D by going to ",Object(f.jsx)("strong",{children:"View > 3D"}),". From there you can left-click to rotate, scroll to zoom, and right-click to pan."]}),Object(f.jsxs)("p",{className:"info",children:["Please report issues or request new features on ",Object(f.jsx)("a",{href:"https://github.com/pcsteppan/woven-images/issues",children:"github."})]})]})}),se=n(40);function ie(e,t){var n=se(e);switch(t.type){case i.SET_HARNESSTOTHREADATTACHMENTS:var a=n.harnesses[t.harnessID],r=n.warpThreads[t.threadID];if(a.threads.has(r))a.threads.delete(r);else{for(var s=0;s<n.harnesses.length;s++)n.harnesses[s].threads.has(r)&&n.harnesses[s].threads.delete(r);a.threads.add(r)}break;case i.SET_TREADLETOHARNESSATTACHMENTS:var c=n.treadles[t.treadleID],o=n.harnesses[t.harnessID];c.harnesses.has(o)?c.harnesses.delete(o):c.harnesses.add(o);break;case i.SET_TREADLINGINSTRUCTION:var l=n.treadles[t.treadleID];n.treadlingInstructions[t.instructionIndex]===l?n.treadlingInstructions[t.instructionIndex]=null:n.treadlingInstructions[t.instructionIndex]=l;break;case i.SET_HARNESSCOUNT:if(t.harnessCount>n.harnesses.length)for(;n.harnesses.length<t.harnessCount;)n.harnesses.unshift(S());else{var d=n.harnesses.splice(0,n.harnesses.length-t.harnessCount);n.treadles.forEach((function(e){d.forEach((function(t){e.harnesses.delete(t)}))}))}n.dimensions.harnessCount=t.harnessCount;break;case i.SET_TREADLECOUNT:if(t.treadleCount>n.treadles.length)for(;n.treadles.length<t.treadleCount;)n.treadles.push(A());else{var u=n.treadles.splice(t.treadleCount);n.treadlingInstructions.forEach((function(e){u.forEach((function(t){e=e===t?null:e}))}))}n.dimensions.treadleCount=t.treadleCount;break;case i.SET_WARPCOUNT:if(t.warpCount>e.warpThreads.length)for(;n.warpThreads.length<t.warpCount;)n.warpThreads.unshift(C(n.warpThreads.length,1));else n.warpThreads.splice(0,n.warpThreads.length-t.warpCount);n.warpThreads.forEach((function(e,t){e.id=t})),n.dimensions.warpCount=t.warpCount;break;case i.SET_WEFTCOUNT:if(t.weftCount>e.weftThreads.length)for(;n.weftThreads.length<t.weftCount;)n.weftThreads.push(C(n.weftThreads.length,0)),n.treadlingInstructions.push(null);else n.weftThreads.splice(t.weftCount),n.treadlingInstructions.splice(t.weftCount);n.dimensions.weftCount=t.weftCount;break;case i.SET_STATE:return t.state;case i.SET_WARPTHREADTHREADPALETTEINDEX:n.warpThreads[t.warpThreadID].threadPaletteIndex=n.indexedThreadPalette.selectedIndex;break;case i.SET_WEFTTHREADTHREADPALETTEINDEX:n.weftThreads[t.weftThreadID].threadPaletteIndex=n.indexedThreadPalette.selectedIndex;break;case i.SET_SELECTEDTHREADDATASOURCE:n.indexedThreadPalette.threadPalette[n.indexedThreadPalette.selectedIndex]=t.dataSource;break;case i.ADD_THREADDATASOURCE:n.indexedThreadPalette.threadPalette.push(se(t.dataSource));break;case i.SET_SELECTEDTHREADDATASOURCEINDEX:n.indexedThreadPalette.selectedIndex=t.dataSourceIndex}return n}var ce=function(e){var t=Object(o.useReducer)(ie,I(b)),n=Object(T.a)(t,2),s=n[0],c=n[1],l=Object(o.useState)(16),d=Object(T.a)(l,2),u=d[0],h=d[1],x=Object(o.useState)(1),j=Object(T.a)(x,2),m=j[0],E=j[1];Object(o.useEffect)((function(){c({type:i.SET_STATE,state:e.currentState})}),[e.currentState]),Object(o.useEffect)((function(){e.onChange(s)}),[e,s]);var O,g,v,S,A=function(e,t){var n=e.target,r=parseInt(n.style.gridRow)-1,s=parseInt(n.style.gridColumn)-1;switch(t){case a.HARNESSTOTHREADTABLE:c({type:i.SET_HARNESSTOTHREADATTACHMENTS,harnessID:r,threadID:s});break;case a.TIEUPTABLE:c({type:i.SET_TREADLETOHARNESSATTACHMENTS,treadleID:s,harnessID:r});break;case a.TREADLINGTABLE:c({type:i.SET_TREADLINGINSTRUCTION,treadleID:s,instructionIndex:r});break;case a.WEFTTHREADTABLE:c({type:i.SET_WEFTTHREADTHREADPALETTEINDEX,weftThreadID:r});break;case a.WARPTHREADTABLE:c({type:i.SET_WARPTHREADTHREADPALETTEINDEX,warpThreadID:s})}};return Object(f.jsxs)("div",{className:"LoomEditorContainer",children:[Object(f.jsx)("div",{className:"LoomPane",children:Object(f.jsxs)("div",{className:"LoomContainer",style:{gridTemplateColumns:s.dimensions.warpCount*u+"px auto auto",gridTemplateRows:"auto auto "+s.dimensions.weftCount*u+"px"},children:[Object(f.jsx)(U,{subGridType:a.WARPTHREADTABLE,cellSize:{width:u,height:u/2},gridValues:s.warpThreads,orientation:r.HORIZONTAL,onClickHandler:A,palette:s.indexedThreadPalette,className:"justifyEnd"}),Object(f.jsx)("span",{className:"void",children:"\xa0"}),Object(f.jsx)("span",{className:"void",children:"\xa0"}),Object(f.jsx)(p,{subGridType:a.HARNESSTOTHREADTABLE,cellSize:u,gridValues:(v=s.warpThreads,S=s.harnesses,new Array(S.length).fill(new Array).map((function(e,t){return new Array(v.length).fill(!1).map((function(e,n){return S[t].threads.has(v[n])}))}))),onClickHandler:A,palette:s.indexedThreadPalette,className:"justifyEnd"}),Object(f.jsx)(p,{subGridType:a.TIEUPTABLE,cellSize:u,gridValues:function(e,t){return new Array(e.length).fill(new Array).map((function(n,a){return new Array(t.length).fill(!1).map((function(n,r){return t[r].harnesses.has(e[a])}))}))}(s.harnesses,s.treadles),onClickHandler:A,palette:s.indexedThreadPalette}),Object(f.jsx)("span",{className:"void",children:"\xa0"}),Object(f.jsxs)("div",{className:"CanvasContainer",children:[Object(f.jsx)(K.a,{className:"CanvasWrapper",gl:{preserveDrawingBuffer:!0},children:Object(f.jsx)(ae,{warpThreadCount:s.dimensions.warpCount,weftThreadCount:s.dimensions.weftCount,unitSize:u,repeats:m,colorBuffer:function(e){var t=e.dimensions.warpCount,n=e.dimensions.weftCount,a=new Array(t*n).fill("#000000");return e.treadlingInstructions.forEach((function(n,r){var s=e.weftThreads[r],i=new Set;null===n||void 0===n||n.harnesses.forEach((function(e){e.threads.forEach((function(e){return i.add(e)}))})),e.warpThreads.forEach((function(n,c){a[function(e,n){return e*t+n}(r,c)]=i.has(n)?e.indexedThreadPalette.threadPalette[n.threadPaletteIndex].color:e.indexedThreadPalette.threadPalette[s.threadPaletteIndex].color}))})),a}(s),cameraMode:e.cameraMode})}),Object(f.jsx)("div",{id:"CanvasResizer",onMouseDown:function(e){return console.log("mdown",e)},onMouseMove:function(e){return console.log("mmove",e)},onMouseUp:function(e){return console.log("mup",e)}})]}),Object(f.jsx)(p,{subGridType:a.TREADLINGTABLE,cellSize:u,gridValues:(O=s.treadles,g=s.treadlingInstructions,new Array(g.length).fill(new Array).map((function(e,t){return new Array(O.length).fill(!1).map((function(e,n){return g[t]===O[n]}))}))),onClickHandler:A,palette:s.indexedThreadPalette}),Object(f.jsx)(U,{subGridType:a.WEFTTHREADTABLE,cellSize:{width:u/2,height:u},gridValues:s.weftThreads,orientation:r.VERTICAL,onClickHandler:A,palette:s.indexedThreadPalette})]})}),Object(f.jsxs)("div",{className:"EditorPanes",children:[Object(f.jsx)(_,{dimensions:s.dimensions,onDimensionsChange:function(e){e=function(e){return Object.fromEntries(Object.entries(e).map((function(e){var t,n=Object(T.a)(e,2);return[n[0],(t=n[1],!isNaN(t)&&t>0?t:1)]})))}(e),c({type:i.SET_HARNESSCOUNT,harnessCount:e.harnessCount}),c({type:i.SET_TREADLECOUNT,treadleCount:e.treadleCount}),c({type:i.SET_WARPCOUNT,warpCount:e.warpCount}),c({type:i.SET_WEFTCOUNT,weftCount:e.weftCount})}}),Object(f.jsxs)(B,{children:[Object(f.jsx)("label",{style:{verticalAlign:"top"},htmlFor:"cellSize",children:"cell size "}),Object(f.jsx)("input",{type:"range",min:"2",max:"16",defaultValue:"16",name:"cellSize",id:"cellSizeSlider",onChange:function(e){var t=e.target;return h(parseInt(t.value))}}),Object(f.jsx)("label",{style:{verticalAlign:"top"},htmlFor:"scaleSlider",children:"pattern scale "}),Object(f.jsx)("input",{type:"range",min:"1",max:"16",defaultValue:"1",name:"scaleSlider",id:"scaleSlider",onChange:function(e){var t=e.target;return E(parseInt(t.value))}})]}),Object(f.jsx)(F,{onSelectThreadDataSource:function(e){c({type:i.SET_SELECTEDTHREADDATASOURCEINDEX,dataSourceIndex:e})},onSetThreadDataSource:function(e){c({type:i.SET_SELECTEDTHREADDATASOURCE,dataSource:e})},onAddThreadDataSource:function(e){c({type:i.ADD_THREADDATASOURCE,dataSource:e})},indexedThreadPalette:s.indexedThreadPalette}),Object(f.jsx)("div",{className:"divider"}),Object(f.jsx)(re,{})]})]})},oe=n(19),le=(n(179),function(e){return Object(f.jsxs)("div",{className:"ToolBarMenu",children:[Object(f.jsx)("div",{className:"ToolBarMenuName",children:e.name}),Object(f.jsx)("div",{className:"ToolBarMenuChildren",children:e.children})]})}),de=(n(180),function(e){return Object(f.jsxs)("div",{onClick:e.onClick,className:e.className?e.className:"ToolBarMenuNode",children:[Object(f.jsx)("span",{children:e.text}),Object(f.jsx)("div",{className:"ToolBarMenuSubNodes "+(e.children?"populated":""),children:e.children})]})}),ue="1+4,1+2,2+3,3+4",he=[{name:"Basic Twill",data:{threading:"1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4",tieup:"1+4,1+2,2+3,3+4",treadling:"1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4"}},{name:"Periwinkle",data:{threading:"3,2,1,4,3,2,1,4,3,4,3,2,3,2,1,4,3,4,1,2,3,2,3,4,3,4,1,2",tieup:"1+4,1+2,2+3,3+4",treadling:"3,2,1,4x3,3x3,2,1,4x2,1,2,3x3,4x3,1,2,3"}},{name:"Diadem",data:{threading:"4,1,2,3,4,1,2,3,4,1,2,3,2,3,2,1,4,3,4,3,4,1,2,1,2,1,4,3,4,3,4,1,2,3,2,3,2,1,4,3,2,1,4,3,2,1,4,1",tieup:"1+4,1+2,2+3,3+4",treadling:"3x2,4,1,2,3,4,1,2,3,4,1x4,4,3,2x4,3,4x4,3,2x4,3,4,1x4,4,3,2,1,4,3,2,1,4,3x2"}},{name:"Rings and Chains",data:{threading:"1,2,3,4,1,2,3,4,1,2,3,4,1,4,1,4,3,4,3,2,3,2,1,2,1,4,1,2,1,4,1,2,1,4,1,2,1,4,1,2,1,4,1,2,1,4,1,2,1,2,3,2,3,4,3,4,1,4,1,4,3,2,1,4,1,2,3,4",tieup:"1+4,1+2,2+3,3+4",treadling:"1,2,3,4,1x4,4x3,3x3,2x3,1x2,2x2,1x2,2x2,1x2,2x2,1x2,2x2,1x2,2x2,1x2,2x3,3x3,4x3,1x4,4,3,2,1"}},{name:"Wheel of Fortune",data:{threading:"1,2,3,4,1,2,1,2,3,2,3,4,3,4,1,4,3,4,1,4,3,4,3,2,3,2,1,2,1,4,3,2,1,4,3,2,1,4,3,2,3,2,1,2,1,4,1,4,3,4,1,4,3,4,1,4,1,2,1,2,3,2,3,4,1,2,3,4",tieup:"1+4,1+2,2+3,3+4",treadling:"2,3,4,1,2x3,3x3,4x3,1x2,4x2,1x2,4x3,3x3,2x3,1,4,3,2,1,4,3,2,1,4,3x3,2x3,1x3,4x2,1x2,4x2,1x3,2x3,3x3,4,1,2,3,4,1"}},{name:"Chariot Wheel No. 3",data:{threading:"4,3,2,1,4,3,2,3,4,3,2,3,4,1,4,1,4,1,2,1,2,1,4,1,2,1,4,1,2,1,2,1,4,1,4,1,4,3,2,3,4,3,2,3,4,1,2,3",tieup:"1+4,1+2,2+3,3+4",treadling:"4,3,2,1,4,3x2,4x2,3x2,4,1x5,2x4,1x2,2x2,1x2,2x4,1x5,4,3x2,4x2,3x2,4,1,2,3,4"}},{name:"Chariot Wheel No. 3 Alt",data:{threading:"4,3,2,1,4,3,2,3,4,3,2,3,4,1,4,1,4,1,2,1,2,1,4,1,2,1,4,1,2,1,2,1,4,1,4,1,4,3,2,3,4,3,2,3,4,1,2,3",tieup:"1+4,1+2,2+3,3+4",treadling:"3,4,1,2,3,4x2,3x2,4x2,3,2x5,1x4,2x2,1x2,2x2,1x4,2x5,3,4x2,3x2,4x2,3,2,1,4,3"}},{name:"Church Windows",data:{threading:"3,2,1,4,3,4,3,4,1,4,1,2,1,4,1,4,3,4,3,4,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,1,4,3,4,3,4,1,4,1,2,1,4,1,4,3,4,3,4,2,1",tieup:"1+4,1+2,2+3,3+4",treadling:"3,2,1,4x4,1x3,2x2,1x3,4x4,1,2,3x2,2x2,3x2,2x2,3x2,2x2,3x2,2x2,3x2,2x2,3x2,2,1,4x4,1x3,2x2,1x3,4x4,1,2,3"}},{name:"Cambridge Beauty",data:{threading:"2,3,4,1,4,1,4,1,4,3,4,3,4,3,2,3,2,3,2,1,2,1,2,1,2,3,4,3,2,1,2,3,4,3,2,1,2,3,4,3,2,1,2,3,4,3,2,1,2,1,2,1,2,3,2,3,2,3,4,3,4,3,4,1,4,1,4,1,4,3",tieup:"1+4,1+2,2+3,3+4",treadling:"3,4,1x6,4x5,3x5,2x6,3,4x2,3,2x2,3,4x2,3,2x2,3,4x2,3,2x2,3,4x2,3,2x2,3,4x2,3,2x6,3x5,4x5,1x6,4,3"}},{name:"Star of Bethlehem",data:{threading:"2,3,4,1,2,3,4,1,2,3,4,1,2,1,2,3,2,3,4,3,4,1,4,1,2,3,4,1,4,3,2,1,4,1,4,3,4,3,2,3,2,1,2,1,4,3,2,1",tieup:"1+4,1+2,2+3,3+4",treadling:"2,3,4,1,2,3,4,1,2,3,4,1,2x3,3x3,4x3,1x3,1,2,3,4,1x2,4,3,2,1x3,4x3,3x3,2x3,1,4,3,2"}},{name:"Maltese Cross",data:{threading:"1,2,3,4,1,2,1,4,1,4,3,4,3,2,3,2,1,2,1,4,1,2,1,4,1,2,1,2,3,2,3,4,3,4,1,4,1,2,1,4,3,2",tieup:"1+4,1+2,2+3,3+4",treadling:"2,1,4,3,2,1,4,3,2x2,3x3,4x3,1x3,2x3,3x2,2x2,3x2,2x3,1x3,4x3,3x3,2x2,3,4,1,2"}},{name:"Orange Peel A",data:{threading:"1,2,3,4,1,2,3,2,3,4,3,4,1,4,1,2,1,4,1,2,1,4,1,2,1,4,1,4,3,4,3,2,3,2,1,4,3,2",tieup:ue,treadling:"2,3,4,1,2,3x3,4x3,1x3,2x2,1x2,2x2,1x2,2x2,1x3,4x3,3x3,2,1,4,3,2"}},{name:"Orange Peel B",data:{threading:"1,2,3,4,1,2,3,2,3,4,3,4,1,4,1,2,1,4,1,2,1,4,1,2,1,4,1,4,3,4,3,2,3,2,1,4,3,2",tieup:ue,treadling:"1,4,3,2,1,4x3,3x3,2x3,1x2,2x2,1x2,2x2,1x2,2x3,3x3,4x3,1,2,3,4,1"}},{name:"Lovers Knot No. 1",data:{threading:"4,3,2,1,2,1,2,3,4,3,4,1,4,3,4,1,4,3,4,3,2,1,2,1,2,3,4,1,2,3,2,1,4,3,2,1,2,3,4,1,2,3,2,1",tieup:ue,treadling:"4,3,2x4,3,4x3,1x2,4x2,1x2,4x3,3,2x4,3,4,1,2,3x2,2,1,4,3,2x2,3,4,1,2,3x2,2,1"}},{name:"Lovers Knot No. 2",data:{threading:"3,2,1,4,3,2,3,2,1,2,3,2,1,2,3,2,3,4,3,4,3,4,1,4,1,4,1,4,3,4,1,4,3,4,1,4,1,4,1,4,3,4,3,4,3,2,3,2,1,2,3,2,1,2,3,2,3,4,1,2,3,2,1,4,3,2,1,2,3,4,1,2",tieup:ue,treadling:"2,3,4,1,2,3x2,2,1,4,3x3,2x2,3x2,2x2,3x3,4x5,1x6,4x2,1x2,4x2,1x6,4x5,3x3,2x2,3x2,2x2,3x3,4,1,2,3x2,2,1,4,3,2"}},{name:"Cross of Tennessee",data:{threading:"4,3,2,1,4,3,2,1,4,1,4,1,4,3,4,3,2,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,4,3,4,1,4,1,4,1,2,3,4,1,2,3,4,1",tieup:ue,treadling:"1,4,3,2,1,4,3,2,1x5,4x3,3,2x2,3x2,2x2,3x2,2x2,3x2,2x2,3x2,2x2,3x2,2x2,3,4x3,1x5,2,3,4,1,2,3,4,1"}}],xe=function(e){var t,n=Object.keys(e.saveStateDict).map((function(t){return n=t,Object(f.jsx)(de,{className:"ToolBarMenuSubNode",text:e.saveStateNames[n],onClick:function(){return e.onLoad(n)}});var n}));return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(le,{name:"File",children:[Object(f.jsx)(de,{text:"Create New",onClick:e.onCreateNew}),Object(f.jsx)(de,{text:"Save",onClick:e.onSave}),Object(f.jsx)(de,{text:"Save As",onClick:e.onSaveAs}),Object(f.jsx)(de,{text:"Export As PNG",onClick:e.onExportAsPng}),Object(f.jsx)(de,{text:"Load",children:Object(oe.a)(n)}),Object(f.jsx)(de,{text:"Load Preset",children:Object(oe.a)((t=he,t.map((function(e){return H(e)})).map((function(t,n){return function(t){return Object(f.jsx)(de,{className:"ToolBarMenuSubNode",text:t.name,onClick:function(){return e.onLoadPreset(t)}})}(t)}))))})]}),Object(f.jsx)(le,{name:"View",children:Object(f.jsxs)(de,{text:"Dimensions",children:[Object(f.jsx)(de,{text:"2D",onClick:function(){return e.onDimensionChange(c.Orthographic)}}),Object(f.jsx)(de,{text:"3D",onClick:function(){return e.onDimensionChange(c.Perspective)}})]})})]})};var Te=function(e,t){var n=function(){if("undefined"===typeof window)return t;try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(a){return console.warn("Error reading localStorage key \u201c".concat(e,"\u201d:"),a),t}},a=Object(o.useState)(n),r=Object(T.a)(a,2),s=r[0],i=r[1];return Object(o.useEffect)((function(){i(n())}),[]),Object(o.useEffect)((function(){var e=function(){i(n())};return window.addEventListener("storage",e),window.addEventListener("local-storage",e),function(){window.removeEventListener("storage",e),window.removeEventListener("local-storage",e)}}),[]),[s,function(t){"undefined"==typeof window&&console.warn("Tried setting localStorage key \u201c".concat(e,"\u201d even though environment is not a client"));try{var n=t instanceof Function?t(s):t;window.localStorage.setItem(e,JSON.stringify(n)),i(n),window.dispatchEvent(new Event("local-storage"))}catch(a){console.warn("Error setting localStorage key \u201c".concat(e,"\u201d:"),a)}}]},fe=(n(181),function(e){return Object(f.jsx)("div",{className:"DialogContainer",children:Object(f.jsx)("div",{className:"DialogBox",children:e.children})})}),je=n(89),pe=n(91),me=n(90);n(182);function Ee(e){var t=e.transformState,n="// ctx contains a shiftLeft and shiftRight method\n// you can also modify any of the state as you would any array in javascript\n// using [...arr], .slice(), etc.\nreturn {\n\t...state,\n\twarpThreads: ctx.shiftRight(state.warpThreads),\n\ttreadlingInstructions: state.treadlingInstructions\n};",a=Object(o.useState)((function(){return Function("state","ctx",n)})),r=Object(T.a)(a,2),s=r[0],i=r[1],c=Object(o.useState)(!1),l=Object(T.a)(c,2),d=l[0],u=l[1],h=Object(o.useState)(400),x=Object(T.a)(h,2),j=x[0],p=x[1],m=Object(o.useState)(!1),E=Object(T.a)(m,2),b=E[0],O=E[1],g=Object(o.useCallback)((function(e){try{var t=Function("state","ctx",e);i((function(){return t}))}catch(n){console.log("invalid input: "+n)}}),[]);return Object(o.useEffect)((function(){var e=null;return d?e=setInterval((function(){t(s)}),j):d||clearInterval(e),function(){return clearInterval(e)}}),[d,j,s,t]),Object(f.jsxs)("div",{className:"scriptbox",children:[Object(f.jsxs)("div",{className:"scriptbox-inputs",children:[Object(f.jsxs)("div",{className:"scriptbox-form",children:[Object(f.jsx)("button",{className:"Btn",onClick:function(){return t(s)},children:"Apply"}),Object(f.jsxs)("div",{children:[Object(f.jsx)("label",{htmlFor:"toggle-loop",children:"Toggle loop:"}),Object(f.jsx)("input",{className:"scriptbox-form--delay-toggle",name:"toggle-loop",type:"checkbox",value:"false",onChange:function(){return u(!d)}})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("label",{htmlFor:"delay-tbx",children:"Delay in ms:"}),Object(f.jsx)("input",{className:"scriptbox-form--delay",name:"delay-tbx",type:"number",min:"200",max:"10000",value:j,onChange:function(e){return p(parseInt(e.target.value))}})]})]}),Object(f.jsx)("button",{className:"Btn",onClick:function(){return O(!b)},children:b?"Show":"Hide"})]}),Object(f.jsx)(je.a,{hidden:b,value:n,height:"20rem",onChange:g,lang:"js",extensions:[Object(pe.a)()],theme:me.a})]})}function be(e){var t=Object(o.useState)(e),n=Object(T.a)(t,2),a=n[0],r=n[1],s=function(e,t,n){return function(a){try{var r=a(e,Oe);if(!n.every((function(e){return e(r)}))){console.error("invalid result. skipping transform application: "+r);var s=n.filter((function(e){return!e(r)}));return void console.log(s,e,r)}t(r)}catch(i){console.error("an error occurred while applying transform: "+i)}}}(a,r,[]);return[a,r,s]}var Oe={shiftRight:function(e){return[e[e.length-1]].concat(Object(oe.a)(e.slice(0,e.length-1)))},shiftLeft:function(e){return[].concat(Object(oe.a)(e.slice(1)),[e[0]])}},ge=n(40),ve=function(){var e=Te("saveStates",{}),t=Object(T.a)(e,2),n=t[0],a=t[1],r=Te("saveStateNames",{}),s=Object(T.a)(r,2),i=s[0],l=s[1],d=function(e){var t=he.filter((function(t){return t.name===e}));return t.length?t[0]:null}("Cross of Tennessee"),u=be(d?H(d):I(b)),j=Object(T.a)(u,3),p=j[0],m=j[1],E=j[2],O=Object(o.useState)(!1),g=Object(T.a)(O,2),v=g[0],C=g[1],N=Object(o.useState)(),w=Object(T.a)(N,2),D=w[0],y=w[1],L=Object(o.useState)(p),k=Object(T.a)(L,2),_=k[0],F=k[1],U=Object(o.useState)(c.Orthographic),B=Object(T.a)(U,2),W=B[0],M=B[1],V=function(){C(!1)},z=Object(f.jsx)(fe,{children:Object(f.jsxs)("form",{className:"w100",onSubmit:function(e){C(!1),e.preventDefault();var t=R(),r=ge(_),s=e.target.newFileName.value;r.name=s,r.id=t;var c=P(_);a(Object(x.a)(Object(x.a)({},n),{},Object(h.a)({},t,c))),l(Object(x.a)(Object(x.a)({},i),{},Object(h.a)({},r.id,r.name))),m(r)},children:[Object(f.jsxs)("div",{className:"w100",children:[Object(f.jsx)("span",{children:"New file name:"}),Object(f.jsx)("input",{type:"text",name:"newFileName",className:"underline w100",placeholder:_.name})]}),Object(f.jsxs)("div",{className:"w100",style:{marginTop:"1em"},children:[Object(f.jsx)("button",{className:"cancelBtn",style:{width:"50%"},onClick:V,children:"Cancel"}),Object(f.jsx)("button",{type:"submit",className:"saveBtn",style:{width:"50%"},children:"Save"})]})]})}),G=Object(f.jsx)(fe,{children:Object(f.jsxs)("form",{className:"w100",onSubmit:function(e){C(!1),e.preventDefault();var t=I(b),n=e.target.fileName.value;t.name=n,m(t)},children:[Object(f.jsxs)("div",{className:"w100",children:[Object(f.jsx)("span",{children:"File name:"}),Object(f.jsx)("input",{type:"text",name:"fileName",className:"underline w100",placeholder:"untitled"})]}),Object(f.jsxs)("div",{className:"w100",style:{marginTop:"1em"},children:[Object(f.jsx)("button",{className:"cancelBtn",style:{width:"50%"},onClick:V,children:"Cancel"}),Object(f.jsx)("button",{type:"submit",className:"saveBtn",style:{width:"50%"},children:"Create"})]})]})}),X=Object(f.jsx)(fe,{children:Object(f.jsxs)("form",{className:"w100",onSubmit:function(e){C(!1),e.preventDefault();var t=document.createElement("a"),n=e.target.fileName.value,a=0===n.length?"woven_image.png":n.endsWith(".png")?n:n+".png";t.setAttribute("download",a);var r=document.querySelector(".CanvasWrapper > canvas");if(r){var s=document.createElement("a");s.setAttribute("download",a),s.setAttribute("href",r.toDataURL("image/png").replace("image/png","image/octet-stream")),s.click()}else console.error("Couldn't find canvas element")},children:[Object(f.jsxs)("div",{className:"w100",children:[Object(f.jsx)("span",{children:"File name:"}),Object(f.jsx)("input",{type:"text",name:"fileName",className:"underline w100",placeholder:"untitled"})]}),Object(f.jsxs)("div",{className:"w100",style:{marginTop:"1em"},children:[Object(f.jsx)("button",{className:"cancelBtn",style:{width:"50%"},onClick:V,children:"Cancel"}),Object(f.jsx)("button",{type:"submit",className:"saveBtn",style:{width:"50%"},children:"Save"})]})]})});return Object(f.jsxs)("div",{className:"Container",children:[Object(f.jsx)(xe,{saveStateDict:n,saveStateNames:i,onCreateNew:function(){y(G),C(!0)},onExportAsPng:function(){y(X),C(!0)},onLoad:function(e){var t=function(e){var t=JSON.parse(e);return t.harnesses=t.harnesses.map((function(e){var n=S();return e.forEach((function(e){n.threads.add(t.warpThreads[e])})),n})),t.treadles=t.treadles.map((function(e){var n=A();return e.forEach((function(e){n.harnesses.add(t.harnesses[e])})),n})),t.treadlingInstructions=t.treadlingInstructions.map((function(e){return t.treadles[e]})),t}(n[e]);m(t)},onLoadPreset:function(e){m(e)},onSaveAs:function(){y(z),C(!0)},onSave:function(){var e=P(_);a(Object(x.a)(Object(x.a)({},n),{},Object(h.a)({},_.id,e))),l(Object(x.a)(Object(x.a)({},i),{},Object(h.a)({},_.id,_.name)))},onDimensionChange:function(e){return M(e)}}),Object(f.jsx)(ce,{currentState:p,onChange:function(e){F(e)},cameraMode:W}),v&&D,Object(f.jsx)(Ee,{transformState:E})]})};n(184),n(185),n(186),n(187);var Se=function(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(ve,{})})},Ae=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,196)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),s(e),i(e)}))};u.a.render(Object(f.jsx)(l.a.StrictMode,{children:Object(f.jsx)(Se,{})}),document.getElementById("root")),Ae()},67:function(e,t,n){},98:function(e,t,n){},99:function(e,t,n){}},[[188,1,2]]]);
//# sourceMappingURL=main.a2dfa623.chunk.js.map